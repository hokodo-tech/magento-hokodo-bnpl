<?xml version="1.0"?>
<!--
/**
 * Copyright Â© 2018-2023 Hokodo. All Rights Reserved.
 * See LICENSE for license details.
 */
-->
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <preference for="Hokodo\BNPL\Api\Data\PaymentMethodInterface" type="Hokodo\BNPL\Model\Data\PaymentMethod" />
    <preference for="Hokodo\BNPL\Api\Data\CompanyInterface" type="Hokodo\BNPL\Model\Data\Company" />
    <preference for="Hokodo\BNPL\Api\Data\CompanyImportInterface" type="Hokodo\BNPL\Model\Data\CompanyImport" />
    <preference for="Hokodo\BNPL\Api\Data\DeferredPaymentInterface" type="Hokodo\BNPL\Model\Data\DeferredPayment" />
    <preference for="Hokodo\BNPL\Api\Data\DeferredPaymentIpnInterface" type="Hokodo\BNPL\Model\Data\DeferredPaymentIpn" />
    <preference for="Hokodo\BNPL\Api\Data\DeferredPaymentIpnPayloadInterface" type="Hokodo\BNPL\Model\Data\DeferredPaymentIpnPayload" />
    <preference for="Hokodo\BNPL\Api\Data\FulfillmentInfoInterface" type="Hokodo\BNPL\Model\Data\FulfillmentInfo" />
    <preference for="Hokodo\BNPL\Api\Data\OrderDocumentsInterface" type="Hokodo\BNPL\Model\Data\OrderDocumentsInfo" />
    <preference for="Hokodo\BNPL\Api\Data\OrderCustomerAddressInterface" type="Hokodo\BNPL\Model\Data\OrderCustomerAddress" />
    <preference for="Hokodo\BNPL\Api\Data\OrderCustomerInterface" type="Hokodo\BNPL\Model\Data\OrderCustomer" />
    <preference for="Hokodo\BNPL\Api\Data\OrderCustomerIpnInterface" type="Hokodo\BNPL\Model\Data\OrderCustomerIpn" />
    <preference for="Hokodo\BNPL\Api\Data\OrderInformationInterface" type="Hokodo\BNPL\Model\Data\OrderInformation" />
    <preference for="Hokodo\BNPL\Api\Data\OrderIpnInterface" type="Hokodo\BNPL\Model\Data\OrderIpn" />
    <preference for="Hokodo\BNPL\Api\Data\OrderItemInterface" type="Hokodo\BNPL\Model\Data\OrderItem" />
    <preference for="Hokodo\BNPL\Api\Data\OrganisationInterface" type="Hokodo\BNPL\Model\Data\Organisation" />
    <preference for="Hokodo\BNPL\Api\Data\OrganisationIpnInterface" type="Hokodo\BNPL\Model\Data\OrganisationIpn" />
    <preference for="Hokodo\BNPL\Api\Data\OrganisationUserInterface" type="Hokodo\BNPL\Model\Data\OrganisationUser" />
    <preference for="Hokodo\BNPL\Api\Data\PaymentOffersInterface" type="Hokodo\BNPL\Model\Data\PaymentOffers" />
    <preference for="Hokodo\BNPL\Api\Data\PaymentPlanInterface" type="Hokodo\BNPL\Model\Data\PaymentPlan" />
    <preference for="Hokodo\BNPL\Api\Data\RejectionReasonInterface" type="Hokodo\BNPL\Model\Data\RejectionReason" />
    <preference for="Hokodo\BNPL\Api\Data\ScheduledPaymentsInterface" type="Hokodo\BNPL\Model\Data\ScheduledPayments" />
    <preference for="Hokodo\BNPL\Api\Data\UserInterface" type="Hokodo\BNPL\Model\Data\User" />
    <preference for="Hokodo\BNPL\Api\Data\UserOrganisationInterface" type="Hokodo\BNPL\Model\Data\UserOrganisation" />
    <preference for="Hokodo\BNPL\Api\DeferredPaymentIpnProcessorInterface" type="Hokodo\BNPL\Model\DeferredPaymentIpnProcessor" />
    <preference for="Hokodo\BNPL\Api\OrderDocumentsManagementInterface" type="Hokodo\BNPL\Model\OrderDocumentsManagement" />
    <preference for="Hokodo\BNPL\Gateway\SubjectReaderInterface" type="Hokodo\BNPL\Gateway\SubjectReader" />

    <!-- Payment Method Facade configuration -->
    <virtualType name="HokodoBnplFacade" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">Hokodo\BNPL\Gateway\Config\Config::CODE</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Hokodo\BNPL\Block\Info</argument>
            <argument name="valueHandlerPool" xsi:type="object">Hokodo\BNPL\Gateway\Config\ValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">Hokodo\BNPL\Gateway\Validator\ValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">Hokodo\BNPL\Gateway\Command\CommandPool</argument>
        </arguments>
    </virtualType>

    <!-- Value handlers infrastructure -->
    <virtualType name="Hokodo\BNPL\Gateway\Config\ValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">Hokodo\BNPL\Gateway\Config\ConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="Hokodo\BNPL\Gateway\Config\ConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">Hokodo\BNPL\Gateway\Config\Config</argument>
        </arguments>
    </virtualType>

    <!-- Validators infrastructure -->
    <virtualType name="Hokodo\BNPL\Gateway\Validator\ValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="country" xsi:type="string">Hokodo\BNPL\Gateway\Validator\CountryValidator</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Validator\CountryValidator" type="Magento\Payment\Gateway\Validator\CountryValidator">
        <arguments>
            <argument name="config" xsi:type="object">Hokodo\BNPL\Gateway\Config\Config</argument>
        </arguments>
    </virtualType>
    <!-- END Validators infrastructure -->

    <!-- Commands infrastructure -->
    <type name="Magento\Payment\Gateway\Command\CommandManagerPool">
        <arguments>
            <argument name="executors" xsi:type="array">
                <item name="hokodo" xsi:type="string">HokodoCommandManager</item>
            </argument>
        </arguments>
    </type>
    <virtualType name="HokodoCommandManager" type="Magento\Payment\Gateway\Command\CommandManager">
        <arguments>
            <argument name="commandPool" xsi:type="object">Hokodo\BNPL\Gateway\Command\CommandPool</argument>
        </arguments>
    </virtualType>

    <virtualType name="Hokodo\BNPL\Gateway\Command\CommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="authorize" xsi:type="string">Hokodo\BNPL\Gateway\Command\DeferredPaymentAuthorize</item>
                <item name="capture" xsi:type="string">Hokodo\BNPL\Gateway\Command\PostSale\CapturePayment</item>
                <item name="capture_partial" xsi:type="string">Hokodo\BNPL\Gateway\Command\PostSale\CapturePayment</item>
                <item name="void" xsi:type="string">Hokodo\BNPL\Gateway\Command\PostSale\VoidPayment</item>
                <item name="cancel" xsi:type="string">Hokodo\BNPL\Gateway\Command\PostSale\VoidPayment</item>
                <item name="refund" xsi:type="string">Hokodo\BNPL\Gateway\Command\PostSale\RefundPayment</item>
                <item name="fetch_transaction_information" xsi:type="string">Hokodo\BNPL\Gateway\Command\DeferredPaymentFetchStatus</item>
                <item name="create_order_documents" xsi:type="string">Hokodo\BNPL\Gateway\Command\CreateOrderDocuments</item>
                <item name="view_order_documents" xsi:type="string">Hokodo\BNPL\Gateway\Command\ViewOrderDocuments</item>
                <item name="hokodo_company_search" xsi:type="string">Hokodo\BNPL\Gateway\Command\CompanySearch</item>
                <item name="deferred_payment_info" xsi:type="string">Hokodo\BNPL\Gateway\Command\DeferredPayment</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="transferFactory" xsi:type="object">Hokodo\BNPL\Gateway\Http\TransferFactory</argument>
            <argument name="client" xsi:type="object">Hokodo\BNPL\Gateway\Http\Client\GuzzleHttpClient</argument>
            <argument name="resultFactory" xsi:type="object">Hokodo\BNPL\Gateway\Command\ResultInterfaceFactory</argument>
            <argument name="validator" xsi:type="object">Hokodo\BNPL\Gateway\Validator\ValidatorComposite</argument>
            <argument name="errorMessageMapper" xsi:type="object">Hokodo\BNPL\Gateway\ErrorMapper\VirtualErrorMessageMapper</argument>
        </arguments>
    </type>

    <type name="Hokodo\BNPL\Gateway\Http\Client\GuzzleHttpClient">
        <arguments>
            <argument name="converter" xsi:type="object">Hokodo\BNPL\Gateway\Http\Converter\JsonToArrayConverter</argument>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>

    <virtualType name="Hokodo\BNPL\Gateway\Command\ResultInterfaceFactory" type="Magento\Payment\Gateway\Command\ResultInterfaceFactory">
        <arguments>
            <argument name="instanceName" xsi:type="string">Hokodo\BNPL\Gateway\Command\Result\Result</argument>
        </arguments>
    </virtualType>

    <virtualType name="Hokodo\BNPL\Gateway\Validator\ValidatorComposite" type="Magento\Payment\Gateway\Validator\ValidatorComposite">
        <arguments>
            <argument name="validators" xsi:type="array">
                <item name="responseCodeValidator" xsi:type="string">Hokodo\BNPL\Gateway\Validator\ResponseCodeValidator</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Hokodo error code mapper -->
    <virtualType name="Hokodo\BNPL\Gateway\ErrorMapper\VirtualConfigReader" type="Magento\Payment\Gateway\ErrorMapper\VirtualConfigReader">
        <arguments>
            <argument name="fileName" xsi:type="string">hokodo_error_mapping.xml</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\ErrorMapper\VirtualMappingData" type="Magento\Payment\Gateway\ErrorMapper\MappingData">
        <arguments>
            <argument name="reader" xsi:type="object">Hokodo\BNPL\Gateway\ErrorMapper\VirtualConfigReader</argument>
            <argument name="cacheId" xsi:type="string">hokodo_error_mapper</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\ErrorMapper\VirtualErrorMessageMapper" type="Magento\Payment\Gateway\ErrorMapper\ErrorMessageMapper">
        <arguments>
            <argument name="messageMapping" xsi:type="object">Hokodo\BNPL\Gateway\ErrorMapper\VirtualMappingData</argument>
        </arguments>
    </virtualType>

    <!-- Logger -->
    <!-- inject HokodoLogger where you need -->
    <type name="Hokodo\BNPL\Service\Form\Element\Version">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Gateway\Request\CreateOrderDocumentsBuilder">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Gateway\Http\TransferFactory">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Observer\OrderPlaceSuccessObserver">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Controller\Adminhtml\Customer\SaveCompanyId">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\CustomerData\HokodoCheckout">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Gateway\Command\PostSale\CapturePayment">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Gateway\Command\PostSale\RefundPayment">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Gateway\Command\PostSale\VoidPayment">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Model\DeferredPaymentIpnProcessor">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Model\Queue\Handler\Documents">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Model\Webapi\HokodoCustomer">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Plugin\Model\CheckoutAgreements\AgreementsProvider">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Plugin\Model\Sales\ResourceModel\Order\Invoice">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Gateway\Response\DeferredPaymentFetchStatusHandler">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Gateway\Response\DeferredPaymentOrderHandler">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Model\Queue\Handler\CompanyImport">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoImportLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Cron\UpdateCreditLimits">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoCronLogger</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Observer\Customer\InvalidateHokodoCustomerObserver">
        <arguments>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>

    <virtualType name="HokodoLogger" type="Magento\Framework\Logger\Monolog">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="error" xsi:type="object">Hokodo\BNPL\Model\Logger\Handler\Error</item>
                <item name="debug" xsi:type="object">Hokodo\BNPL\Model\Logger\Handler\Debug</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="HokodoImportLogger" type="Magento\Framework\Logger\Monolog">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="error" xsi:type="object">Hokodo\BNPL\Model\Logger\Import\Handler\Error</item>
                <item name="debug" xsi:type="object">Hokodo\BNPL\Model\Logger\Import\Handler\Debug</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="HokodoCronLogger" type="Magento\Framework\Logger\Monolog">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="error" xsi:type="object">Hokodo\BNPL\Model\Logger\Cron\Handler\Error</item>
                <item name="debug" xsi:type="object">Hokodo\BNPL\Model\Logger\Cron\Handler\Debug</item>
            </argument>
        </arguments>
    </virtualType>

    <type name="Hokodo\BNPL\Model\Logger\Handler\Error">
        <arguments>
            <argument name="fileName" xsi:type="string">var/log/hokodo_error.log</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Model\Logger\Handler\Debug">
        <arguments>
            <argument name="fileName" xsi:type="string">var/log/hokodo_debug.log</argument>
        </arguments>
    </type>
    <virtualType name="Hokodo\BNPL\Model\Logger\Import\Handler\Error" type="Hokodo\BNPL\Model\Logger\Handler\Error">
        <arguments>
            <argument name="fileName" xsi:type="string">var/log/hokodo_import_error.log</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Model\Logger\Import\Handler\Debug" type="Hokodo\BNPL\Model\Logger\Handler\Debug">
        <arguments>
            <argument name="fileName" xsi:type="string">var/log/hokodo_import_debug.log</argument>
        </arguments>
    </virtualType>

    <virtualType name="Hokodo\BNPL\Model\Logger\Cron\Handler\Error" type="Hokodo\BNPL\Model\Logger\Handler\Error">
        <arguments>
            <argument name="fileName" xsi:type="string">var/log/hokodo_cron_error.log</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Model\Logger\Cron\Handler\Debug" type="Hokodo\BNPL\Model\Logger\Handler\Debug">
        <arguments>
            <argument name="fileName" xsi:type="string">var/log/hokodo_cron_debug.log</argument>
        </arguments>
    </virtualType>
    <!-- End Logger -->

    <!-- Methods builders -->
    <virtualType name="Hokodo\BNPL\Gateway\Request\GetMethodBuilder" type="Hokodo\BNPL\Gateway\Request\MethodBuilder">
        <arguments>
            <argument name="method" xsi:type="string">GET</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\PostMethodBuilder" type="Hokodo\BNPL\Gateway\Request\MethodBuilder">
        <arguments>
            <argument name="method" xsi:type="string">POST</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\PutMethodBuilder" type="Hokodo\BNPL\Gateway\Request\MethodBuilder">
        <arguments>
            <argument name="method" xsi:type="string">PUT</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\PatchMethodBuilder" type="Hokodo\BNPL\Gateway\Request\MethodBuilder">
        <arguments>
            <argument name="method" xsi:type="string">PATCH</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\DeleteMethodBuilder" type="Hokodo\BNPL\Gateway\Request\MethodBuilder">
        <arguments>
            <argument name="method" xsi:type="string">DELETE</argument>
        </arguments>
    </virtualType>
    <!-- End Methods builders -->

    <!-- Endpoints builders -->
    <virtualType name="Hokodo\BNPL\Gateway\Request\DeferredPaymentViewEndpoint" type="Hokodo\BNPL\Gateway\Request\EndpointBuilder">
        <arguments>
            <argument name="subjectReader" xsi:type="object">Hokodo\BNPL\Gateway\DeferredPaymentSubjectReader</argument>
            <argument name="endpoint" xsi:type="string">payment/deferred_payments/:deferredpayment_id</argument>
            <argument name="params" xsi:type="array">
                <item name=":deferredpayment_id" xsi:type="string">deferred_payment_id</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\DeferredPaymentAuthorizeEndpoint" type="Hokodo\BNPL\Gateway\Request\EndpointBuilder">
        <arguments>
            <argument name="subjectReader" xsi:type="object">Hokodo\BNPL\Gateway\DeferredPaymentOrderSubjectReader</argument>
            <argument name="endpoint" xsi:type="string">payment/deferred_payments/:deferredpayment_id</argument>
            <argument name="params" xsi:type="array">
                <item name=":deferredpayment_id" xsi:type="string">hokodo_deferred_payment_id</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Create Order documents Endpoint -->
    <virtualType name="Hokodo\BNPL\Gateway\Request\CreateOrderDocumentsEndpoint" type="Hokodo\BNPL\Gateway\Request\OrderDocumentsEndpoint">
        <arguments>
            <argument name="endpoint" xsi:type="string">payment/orders/:order_id/documents</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\OrderDocumentsEndpoint" type="Hokodo\BNPL\Gateway\Request\EndpointBuilder">
        <arguments>
            <argument name="subjectReader" xsi:type="object">Hokodo\BNPL\Gateway\OrderDocumentsSubjectReader</argument>
            <argument name="params" xsi:type="array">
                <item name=":order_id" xsi:type="string">order_id</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- End Endpoints builders -->

    <!-- User Result -->
    <virtualType name="Hokodo\BNPL\Gateway\Command\User\ResultInterfaceFactory" type="Magento\Payment\Gateway\Command\ResultInterfaceFactory">
        <arguments>
            <argument name="instanceName" xsi:type="string">Hokodo\BNPL\Gateway\Command\Result\User</argument>
        </arguments>
    </virtualType>

    <virtualType name="Hokodo\BNPL\Gateway\Command\Result\User" type="Hokodo\BNPL\Gateway\Command\Result\Result">
        <arguments>
            <argument name="field" xsi:type="string">id</argument>
            <argument name="dataInterface" xsi:type="string">Hokodo\BNPL\Api\Data\UserInterface</argument>
        </arguments>
    </virtualType>

    <!-- Organisation Result -->
    <virtualType name="Hokodo\BNPL\Gateway\Command\Organisation\ResultInterfaceFactory" type="Magento\Payment\Gateway\Command\ResultInterfaceFactory">
        <arguments>
            <argument name="instanceName" xsi:type="string">Hokodo\BNPL\Gateway\Command\Result\Organisation</argument>
        </arguments>
    </virtualType>

    <virtualType name="Hokodo\BNPL\Gateway\Command\Result\Organisation" type="Hokodo\BNPL\Gateway\Command\Result\Result">
        <arguments>
            <argument name="field" xsi:type="string">id</argument>
            <argument name="dataInterface" xsi:type="string">Hokodo\BNPL\Api\Data\OrganisationInterface</argument>
        </arguments>
    </virtualType>

    <!-- Order Result -->
    <virtualType name="Hokodo\BNPL\Gateway\Command\Order\ResultInterfaceFactory" type="Magento\Payment\Gateway\Command\ResultInterfaceFactory">
        <arguments>
            <argument name="instanceName" xsi:type="string">Hokodo\BNPL\Gateway\Command\Result\Order</argument>
        </arguments>
    </virtualType>

    <virtualType name="Hokodo\BNPL\Gateway\Command\Result\Order" type="Hokodo\BNPL\Gateway\Command\Result\Result">
        <arguments>
            <argument name="field" xsi:type="string">id</argument>
            <argument name="dataInterface" xsi:type="string">Hokodo\BNPL\Api\Data\OrderInformationInterface</argument>
        </arguments>
    </virtualType>

    <!-- Create order documents result -->
    <virtualType name="Hokodo\BNPL\Gateway\Command\CreateOrderDocuments" type="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\CreateOrderDocuments\BuilderComposite</argument>
            <argument name="resultFactory" xsi:type="object">Hokodo\BNPL\Gateway\Command\Order\ResultInterfaceFactory</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Command\ViewOrderDocuments" type="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\ViewOrderDocuments\BuilderComposite</argument>
            <argument name="resultFactory" xsi:type="object">Hokodo\BNPL\Gateway\Command\Order\ResultInterfaceFactory</argument>
        </arguments>
    </virtualType>

    <!-- Create Order Documents Request -->
    <virtualType name="Hokodo\BNPL\Gateway\Request\CreateOrderDocuments\BuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="api_key" xsi:type="string">Hokodo\BNPL\Gateway\Request\Authorization\DocumentAuthorizationBuilder</item>
                <item name="uri" xsi:type="string">Hokodo\BNPL\Gateway\Request\CreateOrderDocumentsEndpoint</item>
                <item name="method" xsi:type="string">Hokodo\BNPL\Gateway\Request\PostMethodBuilder</item>
                <item name="documents_body" xsi:type="string">Hokodo\BNPL\Gateway\Request\CreateOrderDocumentsBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- View order document request -->
    <virtualType name="Hokodo\BNPL\Gateway\Request\ViewOrderDocuments\BuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="api_key" xsi:type="string">Hokodo\BNPL\Gateway\Request\AuthorizationBuilder</item>
                <item name="uri" xsi:type="string">Hokodo\BNPL\Gateway\Request\ViewOrderDocumentsEndpointBuilder</item>
                <item name="method" xsi:type="string">Hokodo\BNPL\Gateway\Request\GetMethodBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Order Deferred Payment command -->
    <virtualType name="Hokodo\BNPL\Gateway\Command\DeferredPaymentAuthorize" type="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\DeferredPaymentAuthorize\BuilderComposite</argument>
            <argument name="handler" xsi:type="object">Hokodo\BNPL\Gateway\Response\DeferredPaymentOrderHandler</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Command\DeferredPaymentFetchStatus" type="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\DeferredPaymentAuthorize\BuilderComposite</argument>
            <argument name="handler" xsi:type="object">Hokodo\BNPL\Gateway\Response\DeferredPaymentFetchStatusHandler</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\DeferredPaymentAuthorize\BuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="api_key" xsi:type="string">Hokodo\BNPL\Gateway\Request\Authorization\DeferredPaymentAuthorizationBuilder</item>
                <item name="uri" xsi:type="string">Hokodo\BNPL\Gateway\Request\DeferredPaymentAuthorizeEndpoint</item>
                <item name="method" xsi:type="string">Hokodo\BNPL\Gateway\Request\GetMethodBuilder</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Payment Offers Result -->
    <virtualType name="Hokodo\BNPL\Gateway\Command\PaymentOffer\ResultInterfaceFactory" type="Magento\Payment\Gateway\Command\ResultInterfaceFactory">
        <arguments>
            <argument name="instanceName" xsi:type="string">Hokodo\BNPL\Gateway\Command\Result\PaymentOffer</argument>
        </arguments>
    </virtualType>

    <virtualType name="Hokodo\BNPL\Gateway\Command\Result\PaymentOffer" type="Hokodo\BNPL\Gateway\Command\Result\Result">
        <arguments>
            <argument name="field" xsi:type="string">id</argument>
            <argument name="dataInterface" xsi:type="string">Hokodo\BNPL\Api\Data\PaymentOffersInterface</argument>
        </arguments>
    </virtualType>

    <type name="Hokodo\BNPL\Block\Info">
        <arguments>
            <argument name="config" xsi:type="object">Hokodo\BNPL\Gateway\Config\Config</argument>
        </arguments>
    </type>
    <type name="Hokodo\BNPL\Service\AbstractService">
        <arguments>
            <argument name="commandPool" xsi:type="object">Hokodo\BNPL\Gateway\Command\CommandPool</argument>
        </arguments>
    </type>

    <!-- SDK UPGRADE -->

    <preference for="Hokodo\BNPL\Api\Data\HokodoQuoteInterface" type="Hokodo\BNPL\Model\HokodoQuote" />
    <preference for="Hokodo\BNPL\Api\HokodoQuoteRepositoryInterface" type="Hokodo\BNPL\Model\HokodoQuoteRepository" />
    <preference for="Hokodo\BNPL\Api\Data\HokodoCustomerInterface" type="Hokodo\BNPL\Model\Data\HokodoCustomer" />
    <preference for="Hokodo\BNPL\Api\HokodoCustomerRepositoryInterface" type="Hokodo\BNPL\Model\HokodoCustomerRepository" />
    <type name="Hokodo\BNPL\Gateway\Service\AbstractService">
        <arguments>
            <argument name="commandPool" xsi:type="object">Hokodo\BNPL\Gateway\Command\CommandPool</argument>
        </arguments>
    </type>
    <type name="Magento\Checkout\Model\ShippingInformationManagement">
        <plugin name="after_shipping_address_saved" type="Hokodo\BNPL\Plugin\Model\Checkout\ShippingInformation" sortOrder="10"/>
    </type>
    <type name="Hokodo\BNPL\Plugin\Model\Checkout\ShippingInformation">
        <arguments>
            <argument name="checkoutSession" xsi:type="object">Magento\Checkout\Model\Session\Proxy</argument>
        </arguments>
    </type>
    <type name="Magento\Quote\Model\Quote">
        <plugin name="hokodo_patch_order" type="Hokodo\BNPL\Plugin\Quote\Model\Quote"/>
    </type>
    <type name="Hokodo\BNPL\Model\Webapi\Offer">
        <arguments>
            <argument name="checkoutSession" xsi:type="object">Magento\Checkout\Model\Session\Proxy</argument>
            <argument name="logger" xsi:type="object">HokodoLogger</argument>
        </arguments>
    </type>

    <!-- js SDK API backend-frontend communication config -->
    <preference for="Hokodo\BNPL\Api\Data\Gateway\CreateOrganisationRequestInterface" type="Hokodo\BNPL\Model\Data\Gateway\CreateOrganisationRequest" />
    <preference for="Hokodo\BNPL\Api\Data\Gateway\UserOrganisationInterface" type="Hokodo\BNPL\Model\Data\Gateway\UserOrganisation" />
    <preference for="Hokodo\BNPL\Api\Data\Gateway\CreateUserRequestInterface" type="Hokodo\BNPL\Model\Data\Gateway\CreateUserRequest" />

    <preference for="Hokodo\BNPL\Api\Webapi\OfferInterface" type="Hokodo\BNPL\Model\Webapi\Offer" />
    <preference for="Hokodo\BNPL\Api\Data\Webapi\OfferRequestInterface" type="Hokodo\BNPL\Model\Data\Webapi\OfferRequest" />
    <preference for="Hokodo\BNPL\Api\Data\Webapi\OfferResponseInterface" type="Hokodo\BNPL\Model\Data\Webapi\OfferResponse" />
    <preference for="Hokodo\BNPL\Api\Data\Gateway\CreateOrderRequestInterface" type="\Hokodo\BNPL\Model\Data\Gateway\CreateOrderRequest" />
    <preference for="Hokodo\BNPL\Api\Data\Gateway\PatchOrderRequestInterface" type="\Hokodo\BNPL\Model\Data\Gateway\PatchOrderRequest" />
    <preference for="Hokodo\BNPL\Api\Data\Gateway\OrderCustomerInterface" type="Hokodo\BNPL\Model\Data\Gateway\OrderCustomer" />
    <preference for="Hokodo\BNPL\Api\Data\Gateway\CustomerAddressInterface" type="Hokodo\BNPL\Model\Data\Gateway\CustomerAddress" />
    <preference for="Hokodo\BNPL\Api\Data\Gateway\OrderItemInterface" type="Hokodo\BNPL\Model\Data\Gateway\OrderItem" />
    <preference for="Hokodo\BNPL\Api\Data\Gateway\CreateOfferRequestInterface" type="Hokodo\BNPL\Model\Data\Gateway\CreateOfferRequest" />
    <preference for="Hokodo\BNPL\Api\Data\Gateway\OfferUrlsInterface" type="Hokodo\BNPL\Model\Data\Gateway\OfferUrls" />

    <preference for="Hokodo\BNPL\Api\Webapi\HokodoCustomerInterface" type="Hokodo\BNPL\Model\Webapi\HokodoCustomer"/>
    <preference for="Hokodo\BNPL\Api\Data\Webapi\HokodoCustomerRequestInterface" type="Hokodo\BNPL\Model\Data\Webapi\HokodoCustomerRequest" />
    <preference for="Hokodo\BNPL\Api\Data\Webapi\HokodoCustomerResponseInterface" type="Hokodo\BNPL\Model\Data\Webapi\HokodoCustomerResponse" />

    <!-- Commands infrastructure -->
    <virtualType name="Hokodo\BNPL\Gateway\Command\CommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="sdk_organisation_create" xsi:type="string">Hokodo\BNPL\Gateway\Command\OrganisationCreateSdk</item>
                <item name="sdk_user_create" xsi:type="string">Hokodo\BNPL\Gateway\Command\UserCreateSdk</item>
                <item name="sdk_order_create" xsi:type="string">Hokodo\BNPL\Gateway\Command\OrderCreateSdk</item>
                <item name="sdk_order_get" xsi:type="string">Hokodo\BNPL\Gateway\Command\OrderGetSdk</item>
                <item name="sdk_order_patch" xsi:type="string">Hokodo\BNPL\Gateway\Command\OrderPatchSdk</item>
                <item name="sdk_offer_create" xsi:type="string">Hokodo\BNPL\Gateway\Command\OfferCreateSdk</item>
                <item name="sdk_offer_get" xsi:type="string">Hokodo\BNPL\Gateway\Command\OfferGetSdk</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Organisation create gateway set up -->
    <virtualType name="Hokodo\BNPL\Gateway\Command\OrganisationCreateSdk" type="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\OrganisationCreateSdk\BuilderComposite</argument>
            <argument name="resultFactory" xsi:type="object">Hokodo\BNPL\Gateway\Command\Organisation\ResultInterfaceFactory</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\OrganisationCreateSdk\BuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="api_key" xsi:type="string">Hokodo\BNPL\Gateway\Request\AuthorizationBuilder</item>
                <item name="uri" xsi:type="string">Hokodo\BNPL\Gateway\Request\Sdk\OrganisationEndpointBuilder</item>
                <item name="method" xsi:type="string">Hokodo\BNPL\Gateway\Request\PostMethodBuilder</item>
                <item name="body" xsi:type="string">Hokodo\BNPL\Gateway\Request\Sdk\GeneralSubjectBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\Sdk\OrganisationEndpointBuilder" type="Hokodo\BNPL\Gateway\Request\Sdk\EndpointBuilder">
        <arguments>
            <argument name="endpoint" xsi:type="string">organisations</argument>
        </arguments>
    </virtualType>

    <!-- User create gateway set up -->
    <virtualType name="Hokodo\BNPL\Gateway\Command\UserCreateSdk" type="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\UserCreateSdk\BuilderComposite</argument>
            <argument name="resultFactory" xsi:type="object">Hokodo\BNPL\Gateway\Command\User\ResultInterfaceFactory</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\UserCreateSdk\BuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="api_key" xsi:type="string">Hokodo\BNPL\Gateway\Request\AuthorizationBuilder</item>
                <item name="uri" xsi:type="string">Hokodo\BNPL\Gateway\Request\Sdk\UserEndpointBuilder</item>
                <item name="method" xsi:type="string">Hokodo\BNPL\Gateway\Request\PostMethodBuilder</item>
                <item name="body" xsi:type="string">Hokodo\BNPL\Gateway\Request\Sdk\GeneralSubjectBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\Sdk\UserEndpointBuilder" type="Hokodo\BNPL\Gateway\Request\Sdk\EndpointBuilder">
        <arguments>
            <argument name="endpoint" xsi:type="string">users</argument>
        </arguments>
    </virtualType>

    <!-- Order create gateway set up -->
    <virtualType name="Hokodo\BNPL\Gateway\Command\OrderCreateSdk" type="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\OrderCreateSdk\BuilderComposite</argument>
            <argument name="resultFactory" xsi:type="object">Hokodo\BNPL\Gateway\Command\Order\ResultInterfaceFactory</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\OrderCreateSdk\BuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="api_key" xsi:type="string">Hokodo\BNPL\Gateway\Request\AuthorizationBuilder</item>
                <item name="uri" xsi:type="string">Hokodo\BNPL\Gateway\Request\Sdk\OrderEndpointBuilder</item>
                <item name="method" xsi:type="string">Hokodo\BNPL\Gateway\Request\PostMethodBuilder</item>
                <item name="body" xsi:type="string">Hokodo\BNPL\Gateway\Request\Sdk\GeneralSubjectBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\Sdk\OrderEndpointBuilder" type="Hokodo\BNPL\Gateway\Request\Sdk\EndpointBuilder">
        <arguments>
            <argument name="endpoint" xsi:type="string">payment/orders</argument>
        </arguments>
    </virtualType>

    <!-- Order get gateway set up -->
    <virtualType name="Hokodo\BNPL\Gateway\Command\OrderGetSdk" type="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\OrderGetSdk\BuilderComposite</argument>
            <argument name="resultFactory" xsi:type="object">Hokodo\BNPL\Gateway\Command\Order\ResultInterfaceFactory</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\OrderGetSdk\BuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="api_key" xsi:type="string">Hokodo\BNPL\Gateway\Request\AuthorizationBuilder</item>
                <item name="uri" xsi:type="string">Hokodo\BNPL\Gateway\Request\Sdk\OrderGetEndpointBuilder</item>
                <item name="method" xsi:type="string">Hokodo\BNPL\Gateway\Request\GetMethodBuilder</item>
                <item name="body" xsi:type="string">Hokodo\BNPL\Gateway\Request\Sdk\GeneralSubjectBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\Sdk\OrderGetEndpointBuilder" type="Hokodo\BNPL\Gateway\Request\Sdk\EndpointBuilder">
        <arguments>
            <argument name="endpoint" xsi:type="string">payment/orders/:id</argument>
            <argument name="params" xsi:type="array">
                <item name=":id" xsi:type="string">id</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Order patch gateway set up -->
    <virtualType name="Hokodo\BNPL\Gateway\Command\OrderPatchSdk" type="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\OrderPatchSdk\BuilderComposite</argument>
            <argument name="resultFactory" xsi:type="object">Hokodo\BNPL\Gateway\Command\Order\ResultInterfaceFactory</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\OrderPatchSdk\BuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="api_key" xsi:type="string">Hokodo\BNPL\Gateway\Request\AuthorizationBuilder</item>
                <item name="uri" xsi:type="string">Hokodo\BNPL\Gateway\Request\Sdk\OrderPatchEndpointBuilder</item>
                <item name="method" xsi:type="string">Hokodo\BNPL\Gateway\Request\PatchMethodBuilder</item>
                <item name="body" xsi:type="string">Hokodo\BNPL\Gateway\Request\Sdk\GeneralSubjectBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\Sdk\OrderPatchEndpointBuilder" type="Hokodo\BNPL\Gateway\Request\Sdk\EndpointBuilder">
        <arguments>
            <argument name="endpoint" xsi:type="string">payment/orders/:id</argument>
            <argument name="params" xsi:type="array">
                <item name=":id" xsi:type="string">order_id</item>
            </argument>
        </arguments>
    </virtualType>

    <!-- Offer create gateway set up -->
    <virtualType name="Hokodo\BNPL\Gateway\Command\OfferCreateSdk" type="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\OfferCreateSdk\BuilderComposite</argument>
            <argument name="resultFactory" xsi:type="object">Hokodo\BNPL\Gateway\Command\PaymentOffer\ResultInterfaceFactory</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\OfferCreateSdk\BuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="api_key" xsi:type="string">Hokodo\BNPL\Gateway\Request\AuthorizationBuilder</item>
                <item name="uri" xsi:type="string">Hokodo\BNPL\Gateway\Request\Sdk\OfferEndpointBuilder</item>
                <item name="method" xsi:type="string">Hokodo\BNPL\Gateway\Request\PostMethodBuilder</item>
                <item name="body" xsi:type="string">Hokodo\BNPL\Gateway\Request\Sdk\GeneralSubjectBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\Sdk\OfferEndpointBuilder" type="Hokodo\BNPL\Gateway\Request\Sdk\EndpointBuilder">
        <arguments>
            <argument name="endpoint" xsi:type="string">payment/offers</argument>
        </arguments>
    </virtualType>

    <!-- Offer get gateway set up -->
    <virtualType name="Hokodo\BNPL\Gateway\Command\OfferGetSdk" type="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\OfferGetSdk\BuilderComposite</argument>
            <argument name="resultFactory" xsi:type="object">Hokodo\BNPL\Gateway\Command\PaymentOffer\ResultInterfaceFactory</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\OfferGetSdk\BuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="api_key" xsi:type="string">Hokodo\BNPL\Gateway\Request\AuthorizationBuilder</item>
                <item name="uri" xsi:type="string">Hokodo\BNPL\Gateway\Request\Sdk\OfferGetEndpointBuilder</item>
                <item name="method" xsi:type="string">Hokodo\BNPL\Gateway\Request\GetMethodBuilder</item>
                <item name="body" xsi:type="string">Hokodo\BNPL\Gateway\Request\Sdk\GeneralSubjectBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\Sdk\OfferGetEndpointBuilder" type="Hokodo\BNPL\Gateway\Request\Sdk\EndpointBuilder">
        <arguments>
            <argument name="endpoint" xsi:type="string">payment/offers/:id</argument>
            <argument name="params" xsi:type="array">
                <item name=":id" xsi:type="string">id</item>
            </argument>
        </arguments>
    </virtualType>
    <type name="Magento\CheckoutAgreements\Model\AgreementsProvider">
        <plugin name="hokodo_checkout_agreements_agreements_provider"
                type="Hokodo\BNPL\Plugin\Model\CheckoutAgreements\AgreementsProvider"
                sortOrder="1" disabled="false"/>
    </type>
    <type name="Hokodo\BNPL\Plugin\Model\CheckoutAgreements\AgreementsProvider">
        <arguments>
            <argument name="checkoutSession" xsi:type="object">Magento\Checkout\Model\Session\Proxy</argument>
        </arguments>
    </type>

    <!-- Post Sale Actions v2 -->
    <preference for="\Hokodo\BNPL\Api\Data\Gateway\DeferredPaymentsPostSaleActionInterface" type="\Hokodo\BNPL\Model\Data\Gateway\DeferredPaymentsPostSaleAction" />
    <preference for="\Hokodo\BNPL\Api\Data\PostSaleEventInterface" type="\Hokodo\BNPL\Model\Data\PostSaleEvent" />
    <preference for="\Hokodo\BNPL\Api\Data\PostSaleEventChangesInterface" type="\Hokodo\BNPL\Model\Data\PostSaleEventChanges" />

    <!-- Commands infrastructure -->
    <virtualType name="Hokodo\BNPL\Gateway\Command\CommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="hokodo_post_sale" xsi:type="string">Hokodo\BNPL\Gateway\Command\DeferredPaymentsPostSale</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="Hokodo\BNPL\Gateway\Command\DeferredPaymentsPostSale" type="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\DeferredPaymentsPostSale\BuilderComposite</argument>
            <argument name="resultFactory" xsi:type="object">Hokodo\BNPL\Gateway\Command\DeferredPaymentsPostSale\ResultInterfaceFactory</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\DeferredPaymentsPostSale\BuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="api_key" xsi:type="string">Hokodo\BNPL\Gateway\Request\AuthorizationBuilder</item>
                <item name="uri" xsi:type="string">Hokodo\BNPL\Gateway\Request\DeferredPaymentsPostSale</item>
                <item name="method" xsi:type="string">Hokodo\BNPL\Gateway\Request\PostMethodBuilder</item>
                <item name="body" xsi:type="string">Hokodo\BNPL\Gateway\Request\PostSaleEventBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\DeferredPaymentsPostSale" type="Hokodo\BNPL\Gateway\Request\Sdk\EndpointBuilder">
        <arguments>
            <argument name="endpoint" xsi:type="string">payment/deferred_payments/:payment_id/:type</argument>
            <argument name="params" xsi:type="array">
                <item name=":payment_id" xsi:type="string">payment_id</item>
                <item name=":type" xsi:type="string">type</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\PostSaleEventBuilder" type="Hokodo\BNPL\Gateway\Request\Sdk\GeneralSubjectBuilder">
        <arguments>
            <argument name="endpointBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\DeferredPaymentsPostSale</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Command\DeferredPaymentsPostSale\ResultInterfaceFactory" type="Magento\Payment\Gateway\Command\ResultInterfaceFactory">
        <arguments>
            <argument name="instanceName" xsi:type="string">Hokodo\BNPL\Gateway\Command\Result\PostSaleEvent</argument>
        </arguments>
    </virtualType>

    <virtualType name="Hokodo\BNPL\Gateway\Command\Result\PostSaleEvent" type="Hokodo\BNPL\Gateway\Command\Result\Result">
        <arguments>
            <argument name="field" xsi:type="string">created</argument>
            <argument name="dataInterface" xsi:type="string">Hokodo\BNPL\Api\Data\PostSaleEventInterface</argument>
        </arguments>
    </virtualType>

    <!-- Invoice automatic creation -->
    <type name="Hokodo\BNPL\Gateway\Response\DeferredPaymentFetchStatusHandler">
        <plugin name="hokodo_create_invoice"
                type="Hokodo\BNPL\Plugin\Gateway\CreateInvoiceOnPaymentFetchStatus"/>
    </type>
    <type name="Hokodo\BNPL\Observer\OrderPlaceSuccessObserver">
        <plugin name="hokodo_create_invoice"
                type="Hokodo\BNPL\Plugin\Gateway\CreateInvoiceOnSuccessOrderPlacement"/>
    </type>


    <!-- Order documents -->
    <type name="Magento\Sales\Model\ResourceModel\Order\Invoice">
        <plugin name="hokodo_send_invoice"
                type="Hokodo\BNPL\Plugin\Model\Sales\ResourceModel\Order\Invoice"/>
    </type>
    <preference for="Hokodo\BNPL\Api\Data\OrderDocumentInterface" type="Hokodo\BNPL\Model\Data\OrderDocument"/>
    <preference for="Hokodo\BNPL\Api\OrderDocumentsRepositoryInterface" type="Hokodo\BNPL\Model\OrderDocumentsRepository"/>
    <!-- /Order documents -->

    <!-- Hokodo Company Entity provider set up -->
    <preference for="Hokodo\BNPL\Api\HokodoEntityTypeResolverInterface" type="Hokodo\BNPL\Model\HokodoEntityTypeResolver"/>
    <type name="Hokodo\BNPL\Model\HokodoCompanyProvider">
        <arguments>
            <argument name="companyProviderTypes" xsi:type="array">
                <item name="customer" xsi:type="object">Hokodo\BNPL\Api\HokodoCustomerRepositoryInterface</item>
            </argument>
        </arguments>
    </type>
    <type name="Magento\ImportExport\Model\Import\SampleFileProvider">
        <arguments>
            <argument name="samples" xsi:type="array">
                <item name="hokodo_companies" xsi:type="string">Hokodo_BNPL</item>
            </argument>
        </arguments>
    </type>
    <type name="Magento\Framework\Notification\MessageList">
        <arguments>
            <argument name="messages" xsi:type="array">
                <item name="companyImportSystemMessage" xsi:type="string">Hokodo\BNPL\Model\System\Message\CompanyImportSystemMessage</item>
            </argument>
        </arguments>
    </type>
    <!-- /Hokodo Company Entity provider set up -->

    <!-- Company Search -->
    <preference for="Hokodo\BNPL\Api\Data\Gateway\CompanySearchRequestInterface" type="\Hokodo\BNPL\Model\Data\Gateway\CompanySearchRequest" />
    <virtualType name="Hokodo\BNPL\Gateway\Command\CompanySearch" type="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\CompanySearch\BuilderComposite</argument>
            <argument name="resultFactory" xsi:type="object">Hokodo\BNPL\Gateway\Command\CompanySearch\ResultInterfaceFactory</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\CompanySearch\BuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="api_key" xsi:type="string">Hokodo\BNPL\Gateway\Request\AuthorizationBuilder</item>
                <item name="uri" xsi:type="string">Hokodo\BNPL\Gateway\Request\CompanySearch</item>
                <item name="method" xsi:type="string">Hokodo\BNPL\Gateway\Request\PostMethodBuilder</item>
                <item name="body" xsi:type="string">Hokodo\BNPL\Gateway\Request\CompanySearchEventBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\CompanySearchEventBuilder" type="Hokodo\BNPL\Gateway\Request\Sdk\GeneralSubjectBuilder">
        <arguments>
            <argument name="endpointBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\CompanySearch</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\CompanySearch" type="Hokodo\BNPL\Gateway\Request\Sdk\EndpointBuilder">
        <arguments>
            <argument name="endpoint" xsi:type="string">companies/search</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Command\CompanySearch\ResultInterfaceFactory" type="Magento\Payment\Gateway\Command\ResultInterfaceFactory">
        <arguments>
            <argument name="instanceName" xsi:type="string">\Hokodo\BNPL\Gateway\Command\Result\Company</argument>
        </arguments>
    </virtualType>

    <virtualType name="Hokodo\BNPL\Gateway\Command\Result\Company" type="Hokodo\BNPL\Gateway\Command\Result\Result">
        <arguments>
            <argument name="field" xsi:type="string">id</argument>
            <argument name="dataInterface" xsi:type="string">Hokodo\BNPL\Api\Data\CompanyInterface</argument>
        </arguments>
    </virtualType>
    <!-- /Company Search -->

    <!-- Deferred Payment Service -->
    <virtualType name="Hokodo\BNPL\Gateway\Command\DeferredPayment" type="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\DeferredPayment\BuilderComposite</argument>
            <argument name="resultFactory" xsi:type="object">Hokodo\BNPL\Gateway\Command\DeferredPayment\ResultInterfaceFactory</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\DeferredPayment\BuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="api_key" xsi:type="string">Hokodo\BNPL\Gateway\Request\AuthorizationBuilder</item>
                <item name="uri" xsi:type="string">Hokodo\BNPL\Gateway\Request\DeferredPayment</item>
                <item name="method" xsi:type="string">Hokodo\BNPL\Gateway\Request\GetMethodBuilder</item>
                <item name="body" xsi:type="string">Hokodo\BNPL\Gateway\Request\DeferredPaymentEventBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\DeferredPaymentEventBuilder" type="Hokodo\BNPL\Gateway\Request\Sdk\GeneralSubjectBuilder">
        <arguments>
            <argument name="endpointBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\DeferredPayment</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\DeferredPayment" type="Hokodo\BNPL\Gateway\Request\Sdk\EndpointBuilder">
        <arguments>
            <argument name="endpoint" xsi:type="string">payment/deferred_payments/:deferredpayment_id</argument>
            <argument name="params" xsi:type="array">
                <item name=":deferredpayment_id" xsi:type="string">deferredpayment_id</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Command\DeferredPayment\ResultInterfaceFactory" type="Magento\Payment\Gateway\Command\ResultInterfaceFactory">
        <arguments>
            <argument name="instanceName" xsi:type="string">\Hokodo\BNPL\Gateway\Command\Result\DeferredPayment</argument>
        </arguments>
    </virtualType>

    <virtualType name="Hokodo\BNPL\Gateway\Command\Result\DeferredPayment" type="Hokodo\BNPL\Gateway\Command\Result\Result">
        <arguments>
            <argument name="field" xsi:type="string">id</argument>
            <argument name="dataInterface" xsi:type="string">Hokodo\BNPL\Api\Data\DeferredPaymentInterface</argument>
        </arguments>
    </virtualType>
    <!-- Deferred Payment Service -->

    <!-- Company Credit Limit -->
    <preference for="Hokodo\BNPL\Api\Data\Gateway\CompanyCreditRequestInterface" type="Hokodo\BNPL\Model\Data\Gateway\CompanyCreditRequest" />
    <preference for="Hokodo\BNPL\Api\Data\Company\CreditInterface" type="Hokodo\BNPL\Model\Data\Company\Credit" />
    <preference for="Hokodo\BNPL\Api\Data\Company\CreditLimitInterface" type="Hokodo\BNPL\Model\Data\Company\CreditLimit" />
    <preference for="Hokodo\BNPL\Api\CompanyCreditServiceInterface" type="Hokodo\BNPL\Model\CompanyCreditService" />

    <virtualType name="Hokodo\BNPL\Gateway\Command\CommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="hokodo_company_credit" xsi:type="string">Hokodo\BNPL\Gateway\Command\CompanyCredit</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Command\CompanyCredit" type="Hokodo\BNPL\Gateway\Command\HokodoGatewayCommand">
        <arguments>
            <argument name="requestBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\CompanyCredit\BuilderComposite</argument>
            <argument name="resultFactory" xsi:type="object">Hokodo\BNPL\Gateway\Command\CompanyCredit\ResultInterfaceFactory</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\CompanyCredit\BuilderComposite" type="Magento\Payment\Gateway\Request\BuilderComposite">
        <arguments>
            <argument name="builders" xsi:type="array">
                <item name="api_key" xsi:type="string">Hokodo\BNPL\Gateway\Request\AuthorizationBuilder</item>
                <item name="uri" xsi:type="string">Hokodo\BNPL\Gateway\Request\CompanyCredit</item>
                <item name="method" xsi:type="string">Hokodo\BNPL\Gateway\Request\PostMethodBuilder</item>
                <item name="body" xsi:type="string">Hokodo\BNPL\Gateway\Request\CompanyCreditEventBuilder</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\CompanyCreditEventBuilder" type="Hokodo\BNPL\Gateway\Request\Sdk\GeneralSubjectBuilder">
        <arguments>
            <argument name="endpointBuilder" xsi:type="object">Hokodo\BNPL\Gateway\Request\CompanyCredit</argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Request\CompanyCredit" type="Hokodo\BNPL\Gateway\Request\Sdk\EndpointBuilder">
        <arguments>
            <argument name="endpoint" xsi:type="string">payment/credit_limits/company/:company_id</argument>
            <argument name="params" xsi:type="array">
                <item name=":company_id" xsi:type="string">company_id</item>
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="Hokodo\BNPL\Gateway\Command\CompanyCredit\ResultInterfaceFactory" type="Magento\Payment\Gateway\Command\ResultInterfaceFactory">
        <arguments>
            <argument name="instanceName" xsi:type="string">\Hokodo\BNPL\Gateway\Command\Result\CompanyCredit</argument>
        </arguments>
    </virtualType>

    <virtualType name="Hokodo\BNPL\Gateway\Command\Result\CompanyCredit" type="Hokodo\BNPL\Gateway\Command\Result\Result">
        <arguments>
            <argument name="field" xsi:type="string">company</argument>
            <argument name="dataInterface" xsi:type="string">\Hokodo\BNPL\Api\Data\Company\CreditInterface</argument>
        </arguments>
    </virtualType>
    <!-- /Company Credit Limit -->

    <!-- Update Credit limit section -->
    <type name="Hokodo\BNPL\Gateway\Command\PostSale\CapturePayment">
        <plugin name="update_hokodo_credit_limit_after_capture"
            type="Hokodo\BNPL\Plugin\PostSale\UpdateCompanyCreditLimit"/>
    </type>
    <type name="Hokodo\BNPL\Gateway\Command\PostSale\RefundPayment">
        <plugin name="update_hokodo_credit_limit_after_refund"
            type="Hokodo\BNPL\Plugin\PostSale\UpdateCompanyCreditLimit"/>
    </type>
    <type name="Hokodo\BNPL\Gateway\Command\PostSale\VoidPayment">
        <plugin name="update_hokodo_credit_limit_after_void"
            type="Hokodo\BNPL\Plugin\PostSale\UpdateCompanyCreditLimit"/>
    </type>
    <!-- /Update Credit limit section -->

    <!-- Marketing -->
    <type name="\Hokodo\BNPL\Model\Marketing\TopBanner">
        <arguments>
            <argument name="bannerTypes" xsi:type="array">
                <item name="static/credit" xsi:type="array">
                    <item name="bannerTypeNonLoggedIn" xsi:type="string">top-strip</item>
                    <item name="bannerTypeLoggedIn" xsi:type="string">credit-limit-banner</item>
                    <item name="bannerTypeLoggedInCompanyAssigned" xsi:type="string">credit-limit-top-strip</item>
                    <item name="label" xsi:type="string"><![CDATA[Static promo / Credit limit]]></item>
                </item>
                <item name="discount/credit" xsi:type="array">
                    <item name="bannerTypeNonLoggedIn" xsi:type="string">discount-top-strip</item>
                    <item name="bannerTypeLoggedIn" xsi:type="string">credit-limit-banner</item>
                    <item name="bannerTypeLoggedInCompanyAssigned" xsi:type="string">credit-limit-top-strip</item>
                    <item name="label" xsi:type="string"><![CDATA[Discount promo / Credit limit]]></item>
                </item>
                <item name="static/discount" xsi:type="array">
                    <item name="bannerTypeNonLoggedIn" xsi:type="string">top-strip</item>
                    <item name="bannerTypeLoggedIn" xsi:type="string">discount-top-strip</item>
                    <item name="label" xsi:type="string"><![CDATA[Static promo / Discount promo]]></item>
                </item>
                <item name="discount/discount" xsi:type="array">
                    <item name="bannerTypeNonLoggedIn" xsi:type="string">discount-top-strip</item>
                    <item name="bannerTypeLoggedIn" xsi:type="string">discount-top-strip</item>
                    <item name="label" xsi:type="string"><![CDATA[Discount promo / Discount promo]]></item>
                </item>
            </argument>
        </arguments>
    </type>
    <!-- /Marketing -->
</config>
